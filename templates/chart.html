{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}CCPS530-Flashie - Home{% endblock %}

{% block scripts %}
{{ super() }}

<script src='static/js/Chart.min.js'></script>

<script>
  // Global parameters:
  // do not resize the chart canvas when its container does (keep at 600x400px)
  Chart.defaults.global.responsive = true;

  var middletext = {
    beforeDraw: function (chart) {
      var width = chart.chart.width,
        height = chart.chart.height,
        ctx = chart.chart.ctx;

      ctx.restore();
      var fontSize = (height / 114).toFixed(2);
      ctx.font = fontSize + "em sans-serif";
      ctx.textBaseline = "middle";

      var text = {{ winpercent }} + "%",
      textX = Math.round((width - ctx.measureText(text).width) / 2),
      textY = height / 2;

      ctx.fillText(text, textX, textY);
      ctx.save();
    }
  };

  // define the chart data
  var killData = {
    labels: [{% for d in labels %}
            "Game {{d}}",
            {% endfor %}],
  datasets: [{
    label: 'kills',
    fill: true,
    lineTension: 0.1,
    backgroundColor: "rgba(75,192,192,0.4)",
    borderColor: "rgba(75,192,192,1)",
    borderCapStyle: 'butt',
    borderDash: [],
    borderDashOffset: 0.0,
    borderJoinStyle: 'miter',
    pointBorderColor: "rgba(75,192,192,1)",
    pointBackgroundColor: "#fff",
    pointBorderWidth: 1,
    pointHoverRadius: 5,
    pointHoverBackgroundColor: "rgba(75,192,192,1)",
    pointHoverBorderColor: "rgba(220,220,220,1)",
    pointHoverBorderWidth: 2,
    pointRadius: 1,
    pointHitRadius: 10,
    data: [{% for item in killsvalues %}
                   {{ item }},
            {% endfor %}],
    spanGaps: false
     }]
   }

  var deathData = {
    labels: [{% for d in labels %}
            "Game {{d}}",
            {% endfor %}],
  datasets: [{
    label: 'deaths',
    fill: true,
    lineTension: 0.1,
    backgroundColor: "rgba(75,192,192,0.4)",
    borderColor: "rgba(75,192,192,1)",
    borderCapStyle: 'butt',
    borderDash: [],
    borderDashOffset: 0.0,
    borderJoinStyle: 'miter',
    pointBorderColor: "rgba(75,192,192,1)",
    pointBackgroundColor: "#fff",
    pointBorderWidth: 1,
    pointHoverRadius: 5,
    pointHoverBackgroundColor: "rgba(75,192,192,1)",
    pointHoverBorderColor: "rgba(220,220,220,1)",
    pointHoverBorderWidth: 2,
    pointRadius: 1,
    pointHitRadius: 10,
    data: [{% for item in deathsvalues %}
                   {{ item }},
            {% endfor %}],
    spanGaps: false
     }]
   }

  var combinedKDdata = {
    labels: [{% for d in labels %}
            "Game {{d}}",
            {% endfor %}],
  datasets: [{
    label: '{{ legend }}',
    data: [{% for item in killsvalues %}
                   {{ item }},
            {% endfor %}],
            label: "Kills",
            borderColor: "#3e95cd",
            fill: false
    }, {
      data: [{% for item in deathsvalues %}
                   {{ item }},
            {% endfor %}],
            label: "Deaths",
            borderColor: "#8e5ea2",
            fill: false

    }]
   }

  // define the chart data
  var gpmcdata = {
    label: 'gold per minute',
    labels: [{% for item in labels %}
  "{{item}}",
    {% endfor %}],
  options: {
    scales: {
      xAxes: [
        {
          ticks: {
            display: false
          }
        }
      ],
        yAxes: [{
          ticks: {
            beginAtZero: true
          }
        }]
    }
  },
  datasets: [{
    //label: '{{ legend }}',
    fill: true,

    lineTension: 0.1,
    backgroundColor: "#e1b12c",
    borderColor: "rgba(75,192,192,1)",
    borderCapStyle: 'butt',
    borderDash: [],
    borderDashOffset: 0.0,
    borderJoinStyle: 'miter',
    pointBorderColor: "rgba(75,192,192,1)",
    pointBackgroundColor: "#fff",
    pointBorderWidth: 1,
    pointHoverRadius: 5,
    pointHoverBackgroundColor: "rgba(75,192,192,1)",
    pointHoverBorderColor: "rgba(220,220,220,1)",
    pointHoverBorderWidth: 2,
    pointRadius: 1,
    pointHitRadius: 10,
    data: [{% for item in gpmdata %}
                   {{ item }},
  {% endfor %}],
    spanGaps: false
     }]
   }

  var winchartData = {
    labels: ["Win", "Loss"],
    datasets: [{
      label: 'Wins',
      backgroundColor: ["#27ae60", "#c0392b"],
      data: [{{ wins }}, {{ losses }}]
     }]
   }

  // get chart canvas
  var ctx = document.getElementById("myChart").getContext("2d");
  var ctx2 = document.getElementById("myChart2").getContext("2d");

  var gpmc = document.getElementById("gpmChart").getContext("2d");


  var winscanvas = document.getElementById("myChart3");
  var ctx3 = winscanvas.getContext("2d");

  var ctx4 = document.getElementById("myChart4").getContext("2d");

  // create the chart using the chart canvas
  var myChart = new Chart(ctx, {
    type: 'line',
    data: killData,
  });

  var myChart2 = new Chart(ctx2, {
    type: 'bar',
    data: deathData,
  });

  var myChart3 = new Chart(winscanvas, {
    type: 'doughnut',
    data: winchartData,
    plugins: middletext,
    options: {
      responsive: true,
      cutoutPercentage: 75,
      legend: {
        display: false
      }
    }
  });

  var myChart4 = new Chart(ctx4, {
    type: 'line',
    data: combinedKDdata,
  });

  var gpmChart = new Chart(gpmc, {
    type: 'bar',
    data: gpmcdata,
  });



</script>
{% endblock %}


{% block page_content %}


<!-- bar chart canvas element -->
<div class="container">
  <div class ="row">
        <div class="col-xs-4 col-sm-1">
          <img src="/static/uploads/{{ avatarimg }}" alt="Profile Picture" class="img-responsive img-rounded" style="max-height: 100px; max-width: 100px;">
        </div>
        <div class="col-xs-1 col-sm-1">
        </div>
        <div class="col-xs-9 col-sm-10">
            <h1 class="display-1">Simple Chart <small>small</small></h1>
        </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-info">
        <div class="panel-heading">
          Kill line chart
        </div>
        <div class="panel-body">
          <canvas id="myChart" width="800" height="450"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-success ">
        <div class="panel-heading">
          Kill bar chart
        </div>
        <div class="panel-body">
          <canvas id="myChart2" width="800" height="450"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-info">
        <div class="panel-heading">
          Win ratio
        </div>
        <div class="panel-body">
          <canvas id="myChart3" width="800" height="450"></canvas>
          <h3 style="text-align: center">{{ wins }} wins, {{ losses }} losses</h3>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-info">
        <div class="panel-heading">
          Gold per minute.
        </div>
        <div class="panel-body">
          <canvas id="gpmChart" width="800" height="450"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-info">
        <div class="panel-heading">
        KDA
        </div>
        <div class="panel-body">
          <h1 class = "display-3">{{ kda }} KDA</h1>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-sm-6">
      <div class="panel panel-info">
        <div class="panel-heading">
          Combined KD
        </div>
        <div class="panel-body">
          <canvas id="myChart4" width="800" height="450"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{{ wtf.quick_form(form) }}

<h1></h1>
<p>The local date and time is {{ moment(current_time).format('LLL') }}.</p>
<p>That was {{ moment(current_time).fromNow(refresh=True) }}.</p>
{% endblock %}